<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF —Å—á–µ—Ç–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .field { margin: 15px 0; }
        .field label { display: block; margin-bottom: 5px; font-weight: bold; }
        .field input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 10px 5px; }
        .btn:hover { background: #0056b3; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .result { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px; }
        .error { color: red; }
        .success { color: green; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .spinner { animation: spin 1s linear infinite; }
    </style>
</head>
<body>
    <div class="container">
        <h1>–¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF —Å—á–µ—Ç–æ–≤</h1>
        
        <div class="field">
            <label for="inn">–ò–ù–ù –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –ò–ü:</label>
            <input type="text" id="inn" placeholder="–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä)" value="7449006730">
        </div>
        
        <div class="field">
            <label for="email">Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
            <input type="email" id="email" placeholder="–í–≤–µ–¥–∏—Ç–µ email" value="demonco@yandex.ru">
        </div>
        
        <div class="field">
            <label for="token">JWT —Ç–æ–∫–µ–Ω:</label>
            <input type="text" id="token" placeholder="–í–≤–µ–¥–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω" value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTc3NDg4MTEsImlhdCI6MTc1Nzc0NzkxMSwidHlwZSI6ImFjY2VzcyIsInVzZXJfaWQiOjV9._H7ONqYNQkUJeKjz9KgdFb9FlqxRo3eaNOAHpXFntbo">
        </div>
        
        <button id="generate-pdf-btn" class="btn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF —Å—á–µ—Ç</button>
        <button id="generate-html-btn" class="btn">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å HTML —Å—á–µ—Ç</button>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        document.getElementById('generate-pdf-btn').addEventListener('click', async function() {
            const inn = document.getElementById('inn').value.trim();
            const email = document.getElementById('email').value.trim();
            const token = document.getElementById('token').value.trim();
            const result = document.getElementById('result');
            const btn = this;
            
            if (!inn || !/^\d{10,12}$/.test(inn)) {
                result.innerHTML = '<span class="error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ò–ù–ù (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä).</span>';
                result.style.display = 'block';
                return;
            }
            
            if (!email) {
                result.innerHTML = '<span class="error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ email.</span>';
                result.style.display = 'block';
                return;
            }
            
            if (!token) {
                result.innerHTML = '<span class="error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω.</span>';
                result.style.display = 'block';
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner">‚ü≥</span> –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF...';
            result.style.display = 'none';
            
            try {
                const pdfUrl = `https://portaldata.ru/api/buh/makeinvoice?inn=${encodeURIComponent(inn)}&email=${encodeURIComponent(email)}&token=${encodeURIComponent(token)}`;
                
                // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                const downloadLink = document.createElement('a');
                downloadLink.href = pdfUrl;
                downloadLink.download = `invoice_${inn}_${new Date().toISOString().slice(0,10)}.pdf`;
                downloadLink.target = '_blank';
                downloadLink.className = 'btn';
                downloadLink.innerHTML = 'üìÑ –°–∫–∞—á–∞—Ç—å PDF —Å—á–µ—Ç';
                
                result.innerHTML = '<span class="success">PDF —Å—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!</span><br><br>';
                result.appendChild(downloadLink);
                result.style.display = 'block';
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞–µ–º PDF
                downloadLink.click();
                
            } catch (error) {
                result.innerHTML = `<span class="error">–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF: ${error.message}</span>`;
                result.style.display = 'block';
            } finally {
                btn.disabled = false;
                btn.innerHTML = '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF —Å—á–µ—Ç';
            }
        });
        
        document.getElementById('generate-html-btn').addEventListener('click', async function() {
            const inn = document.getElementById('inn').value.trim();
            const email = document.getElementById('email').value.trim();
            const token = document.getElementById('token').value.trim();
            const result = document.getElementById('result');
            const btn = this;
            
            if (!inn || !/^\d{10,12}$/.test(inn)) {
                result.innerHTML = '<span class="error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ò–ù–ù (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä).</span>';
                result.style.display = 'block';
                return;
            }
            
            if (!email) {
                result.innerHTML = '<span class="error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ email.</span>';
                result.style.display = 'block';
                return;
            }
            
            if (!token) {
                result.innerHTML = '<span class="error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω.</span>';
                result.style.display = 'block';
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner">‚ü≥</span> –ó–∞–≥—Ä—É–∑–∫–∞ HTML...';
            result.style.display = 'none';
            
            try {
                const htmlUrl = `https://portaldata.ru/api/buh/makeinvoice.html?inn=${encodeURIComponent(inn)}&email=${encodeURIComponent(email)}&token=${encodeURIComponent(token)}`;
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º HTML –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
                window.open(htmlUrl, '_blank');
                
                result.innerHTML = '<span class="success">HTML —Å—á–µ—Ç –æ—Ç–∫—Ä—ã—Ç –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ!</span>';
                result.style.display = 'block';
                
            } catch (error) {
                result.innerHTML = `<span class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ HTML: ${error.message}</span>`;
                result.style.display = 'block';
            } finally {
                btn.disabled = false;
                btn.innerHTML = '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å HTML —Å—á–µ—Ç';
            }
        });
    </script>
</body>
</html>
